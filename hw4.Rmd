---
title: R_GIS_HW04
author: Derek Ding 
date: "`r Sys.Date()`" 
output:
  html_document:
    df_print: paged
    code_folding: show
---

# Week 4 HW

## 0. Homework objective:
- Read in global [gender inequality](https://hdr.undp.org/data-center/documentation-and-downloads) data
- Join the global gender inequality index to [spatial data of the World](https://hub.arcgis.com/datasets/2b93b06dc0dc4e809d3c8db5cb96ba69_0/explore?location=-0.111978%2C0.000000%2C1.00), creating a new column of difference in inequality between 2010 and 2019 
- Share it with the World on GitHub

## 1. Load libraries and Import Data

In this assignment we will use the following libraries:

### 1.1 Libraries
```{r echo= TRUE, error=TRUE}
library(sf)
library(tidyverse)
# library(dplyr)
library(shiny)
library(tmap)
library(tmaptools)
library(readxl)
library(sf)
library(here)
library(leaflet)
library(raster)
library(dplyr)
library(terra)
library(countrycode)
```

### 1.2 Read in the datasets.
There is a dedicated local data dir on disk D.
Its dir is stored in a .txt file. 


#### 1.2.1 GDI:
The following code, reads the data dir and piece with the data folder dir,
forming a machine-readable single string input.

When you download the code, please be careful with the dir, remember to modify the
dir in your .txt file.
```{r echo= TRUE, error=TRUE}
con <- file(here("dir_instructions","data_dir.txt"),"r")
dir_to_disk_d <- readLines(con,n=1)
close(con)

typeof(dir_to_disk_d)

gender.inequality.90to21 <- read.csv(paste(dir_to_disk_d, "HDR21-22_Composite_indices_complete_time_series.csv", sep=""), na = "n/a")
```
#### 1.2.2 GDI:


```{r echo= TRUE, error=TRUE}
con <- file(here("dir_instructions","data_dir.txt"),"r")
dir_to_disk_d <- readLines(con,n=1)
close(con)

typeof(dir_to_disk_d)

world.countries <- read.csv(paste(dir_to_disk_d, "World_Countries_Generalized.csv", sep=""), na = "n/a")
```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```

## 2. Data Wrangling

### 2.1 Claean the Gender Inequality Dataframe

Use only 2010 and 2019 data:
```{r echo= TRUE, error=TRUE}
gender.gdi <- gender.inequality.90to21 %>% 
  dplyr::select(
    contains("gdi") | contains("country")
    )
```

now filter out non 2010 and 2019 data.
```{r echo= TRUE, error=TRUE}
gender.gdi.10_19 <- gender.gdi %>% 
  dplyr::select(
    contains("2010") | contains("2019") | contains("country")
  )
```


### 2.2 Join two datasets
```{r echo= TRUE, error=TRUE}

```


### 2.3 Data Warehousing

Store data to NoSQL db. 
No schema for now.
```{r echo= TRUE, error=TRUE}
library(mongolite)
connection_string = 'mongodb+srv://<username>:<password>@<cluster-name>.mongodb.net/sample_training'
trips_collection = mongo(collection="trips", db="sample_training", url=connection_string)
```

#### 2.3.0 Basic MongoDB for R
```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

#### 2.3.1 Clean the datasets previously downloaded.


```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```

#### 2.3.2 Create Collections for each
```{r echo= TRUE, error=TRUE}

```

#### 2.3.3 Inserting the data to DB
```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```


## 3. Data Description

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```
## 4. Data Description
```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}
gapminder
```







```{r echo= TRUE, error=TRUE}
library(gapminder)
library(gifski)
library(av)
# Charge libraries:
library(ggplot2)
library(gganimate)
 

## standard ggplot2
myPlot <- ggplot(gapminder, aes(gdpPercap, lifeExp, size = pop, colour = country)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  # Here comes the gganimate specific bits
  labs(title = 'Year: {frame_time}', x = 'GDP per capita', y = 'life expectancy') +
  transition_time(year) +
  ease_aes('linear')

animate(myPlot, duration = 10, fps = 24, width = 400, height = 400, renderer = gifski_renderer())
anim_save("output.gif")
```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```



```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```




## Appendix superseded code

Install country code:
```{r echo= TRUE, error=TRUE}
install.packages("countrycode")
```

```{r echo= TRUE, error=TRUE}
install.packages("gganimate")
```
the `gifski` package for gif output
- the `av` package for video output
```{r echo= TRUE, error=TRUE}
install.packages("gifski")
install.packages("av")
```

```{r echo= TRUE, error=TRUE}
install.packages("mongolite")
```

```{r echo= TRUE, error=TRUE}

install.packages("lubridate") 
```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}

```


```{r echo= TRUE, error=TRUE}

```

```{r echo= TRUE, error=TRUE}
install.packages("mongolite")
```


```{r echo= TRUE, error=TRUE}




con <- file(here("dir_instructions","tools_dir.txt"),"r")
dir_to_tools <- readLines(con,n=1)
close(con)

typeof(dir_to_tools)
```

```{r echo= TRUE, error=TRUE}
tool.str = paste(dir_to_tools,"extract_dataframe_col_name_str.R")
source(tool.str,local=TRUE)
```


```{r echo= TRUE, error=TRUE}
paste(dir_to_tools,"extract_dataframe_col_name_str.R")
```

```{r echo= TRUE, error=TRUE}
getwd()
```


```{r echo= TRUE, error=TRUE}
con <- file(paste(dir_to_tools,"extract_dataframe_col_name_str.R"))
tools.str <- readLines(con)
close(con)
```
